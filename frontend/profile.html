<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profile - CampusConnect</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
  <!-- Custom CSS -->
  <link rel="stylesheet" href="css/profile.css">
  <link rel="stylesheet" href="css/theme.css">
</head>
<body>

  <!-- SIDEBAR -->
  <nav class="sidebar">
      <h2 class="logo">CampusConnect</h2>
      <ul class="nav-links">
        <li><a href="home2.html"><i class="bi bi-house-door"></i> Home</a></li>
        <li><a href="blog.html"><i class="bi bi-journal-text"></i> Blogs</a></li>
        <li><a href="challenges.html"><i class="bi bi-flag"></i> Challenges</a></li>
        <li><a href="leaderboard.html"><i class="bi bi-trophy"></i> Leaderboard</a></li>
        <li><a href="resources.html"><i class="bi bi-book"></i> Resources</a></li>
        <li><a class="active" href="profile.html"><i class="bi bi-person-circle"></i> Profile</a></li>
      </ul>
  </nav>

  <!-- MAIN CONTENT -->
  <div class="main-content">

    <!-- PROFILE HEADER -->
    <div class="d-flex flex-column flex-lg-row align-items-start gap-4">

      <!-- LEFT: Profile Avatar + Bio -->
      <div class="profile-section">
        <div class="profile-banner"></div>
        <div class="profile-logo-card text-center">
          <!-- Single avatar that opens the profile dropdown -->
          <div class="d-flex align-items-center justify-content-center">
            <img id="profileDropdown" src="https://i.ibb.co/5T0QzBk/profile-avatar.png" alt="Profile Avatar" class="profile-avatar dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false" style="cursor:pointer">
            <input id="profileImageInputInline" type="file" accept="image/*" style="display:none">
          </div>
          <div class="d-flex align-items-center gap-2">
            <h4 id="profileName" class="profile-name mt-2 mb-0">Profile</h4>
            <button id="editNameBtn" type="button" class="btn btn-link p-0 ms-2" title="Edit name"><i class="bi bi-pencil" aria-hidden="true"></i><span class="visually-hidden">Edit name</span></button>
          </div>
          <div id="nameEditor" style="display:none; margin-top:6px">
            <input id="nameInput" class="form-control form-control-sm" style="display:inline-block; width:auto;" />
            <button id="nameSaveBtn" type="button" class="btn btn-sm btn-primary ms-2">Save</button>
            <button id="nameCancelBtn" type="button" class="btn btn-sm btn-secondary ms-1">Cancel</button>
          </div>
          <div id="profileMeta" class="small text-muted mt-1 d-flex gap-3 align-items-center">
            <span id="memberSince"></span>
            <span id="metaSeparator">â€¢</span>
            <span id="postsCount">Posts: 0</span>
            <span id="challengesCount">Challenges: 0</span>
          </div>
          <div id="profileBadges" class="mt-2">
            <!-- badges like Contributor / Challenger will be injected here -->
          </div>
        </div>
      </div>

      <!-- RIGHT: Dropdown + Cards -->
      <div class="dashboard-section flex-grow-1">

        <!-- Profile functions accessible from the avatar dropdown -->
        <div class="d-flex justify-content-end mb-3">
          <!-- Visible Settings button (opens full settings page) -->
          <a id="settingsBtn" class="btn btn-outline-secondary btn-sm me-2" href="settings.html" title="Open Settings">
            <i class="bi bi-gear"></i> Settings
          </a>
          <button id="logoutBtnVisible" type="button" class="btn btn-outline-danger btn-sm me-2" title="Logout">
            <i class="bi bi-box-arrow-right"></i> Logout
          </button>
          <div class="dropdown">
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="profileDropdown">
              <li><a class="dropdown-item" href="settings.html">Settings</a></li>
              <li><a class="dropdown-item" href="notifications.html">Notifications</a></li>
              <li><a class="dropdown-item" href="write-blog.html">Write Blog</a></li>
              <li><a class="dropdown-item" href="#" id="logoutBtn">Logout</a></li>
            </ul>
          </div>
        </div>

        <!-- Streak Card -->
        <div id="streakCard" class="dashboard-card mb-3 text-center">
          <img src="https://i.ibb.co/5vR8k2S/streak.png" alt="Streak Image" class="mb-2 removable-image" style="width:100px">
          <h5>Streak</h5>
          <div id="streakDays" class="streak-number">0</div>
          <div class="d-flex justify-content-between mt-2 days">
            <span>Sun</span><span>Mon</span><span>Tue</span>
            <span>Wed</span><span>Thu</span><span>Fri</span><span>Sat</span>
          </div>
        </div>

        <!-- Quick stats -->
        <div class="d-flex gap-3 mb-3">
          <div class="info-card"><div id="followersCount">0 Followers</div></div>
          <div class="info-card"><div id="followingCount">0 Following</div></div>
          <div class="info-card"><div id="likesCount">0 Likes</div></div>
        </div>

        <!-- About / Bio (editable) -->
        <div class="dashboard-card mb-3">
          <div class="d-flex justify-content-between align-items-start">
            <h5 class="mb-0">About</h5>
            <div>
              <button id="editBioBtn" class="btn btn-sm btn-outline-primary">Edit</button>
            </div>
          </div>
          <div id="bioDisplay" class="mt-2">
            <div id="bioText" class="small text-muted">You haven't added a bio yet.</div>
          </div>
          <div id="bioEditor" style="display:none" class="mt-2">
            <textarea id="bioInput" rows="4" class="form-control"></textarea>
            <div class="d-flex justify-content-between align-items-center mt-2">
              <div>
                <button id="saveBioBtn" class="btn btn-sm btn-primary">Save</button>
                <button id="cancelBioBtn" class="btn btn-sm btn-secondary">Cancel</button>
                <span id="bioStatus" class="ms-2 text-success" style="display:none">Saved</span>
                <span id="bioDraftStatus" class="ms-2 text-muted" style="display:none">Draft restored</span>
              </div>
              <div>
                <button id="togglePreview" class="btn btn-sm btn-outline-secondary">Preview</button>
                <span id="bioCounter" class="small text-muted ms-2">0/500</span>
              </div>
            </div>
            <div id="bioPreview" class="mt-2" style="display:none"></div>
          </div>
        </div>

        <!-- Profile completion -->
        <div class="dashboard-card mb-3">
          <h5>Profile Completion</h5>
          <div class="progress mt-2">
            <div id="profileCompletionBar" class="progress-bar" role="progressbar" style="width:0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
          </div>
          <div id="profileCompletionText" class="small mt-2">0% complete</div>
          <div class="d-flex gap-2 mt-2 small">
            <label class="form-check form-check-inline"><input id="c_name" class="form-check-input" type="checkbox" disabled> Name</label>
            <label class="form-check form-check-inline"><input id="c_bio" class="form-check-input" type="checkbox" disabled> Bio</label>
            <label class="form-check form-check-inline"><input id="c_post" class="form-check-input" type="checkbox" disabled> Post</label>
            <label class="form-check form-check-inline"><input id="c_bookmarks" class="form-check-input" type="checkbox" disabled> Bookmarks</label>
          </div>
        </div>

        <!-- Posts grid is visible on profile -->
        <div id="myPostsList"></div>

        <!-- Recent activity (joined challenges) -->
        <div id="recentActivity" class="mt-3"></div>

        <!-- Top Writers (leaderboard snapshot) -->
        <div id="profileLeaderboard" class="mt-3">
          <div class="dashboard-card p-3">
            <h6 class="mb-2">Top Writers</h6>
            <div id="profileLeaderboardList">
              <div class="small text-muted">Loading...</div>
            </div>
          </div>
        </div>

        <!-- Saved resources (bookmarks) -->
        <div id="savedResources" class="mt-3">
          <div class="dashboard-card p-3">
            <div class="d-flex justify-content-between align-items-center">
              <h6 class="mb-2">Saved Resources</h6>
              <a href="resources.html" class="btn btn-sm btn-outline-primary">Browse all</a>
            </div>
            <div id="savedResourcesList">
              <!-- Static dummy items visible before JS loads -->
              <div class="mb-2 d-flex justify-content-between align-items-start">
                <div>
                  <strong>HTML &amp; CSS Basics</strong>
                  <div class="small text-muted">A short guide to responsive HTML and CSS</div>
                </div>
                <div><a href="https://developer.mozilla.org/" target="_blank" class="btn btn-sm btn-primary">Open</a></div>
              </div>
              <div class="mb-2 d-flex justify-content-between align-items-start">
                <div>
                  <strong>JavaScript Guide</strong>
                  <div class="small text-muted">Modern JS features explained</div>
                </div>
                <div><a href="https://javascript.info/" target="_blank" class="btn btn-sm btn-primary">Open</a></div>
              </div>
            </div>
          </div>
        </div>



      </div>
    </div>

  </div>
  <div id="profileMessage" class="p-3" style="display:none"></div>
  <div id="profileLoading" class="p-3 text-center" style="display:none"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div></div>

  <!-- Followers Modal -->
  <div class="modal fade" id="followersModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Followers</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div id="followersList">Loading...</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Following Modal -->
  <div class="modal fade" id="followingModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Following</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div id="followingList">Loading...</div>
        </div>
      </div>
    </div>
  </div>

  <script src="js/settings.js"></script>
  <!-- Load socket.io client from backend origin; fallback to CDN if unavailable -->
  <script>
    (function(){
      try {
        var backendBase = (window.API_BASE && typeof window.API_BASE === 'string') ? window.API_BASE.replace(/\/api\/?$/, '') : 'http://localhost:4000';
        var s = document.createElement('script');
        s.src = backendBase + '/socket.io/socket.io.js';
        s.onerror = function(){
          var cdn = document.createElement('script'); cdn.src = 'https://cdn.socket.io/4.6.1/socket.io.min.js'; document.head.appendChild(cdn);
        };
        document.head.appendChild(s);
      } catch (e) { var cdn = document.createElement('script'); cdn.src = 'https://cdn.socket.io/4.6.1/socket.io.min.js'; document.head.appendChild(cdn); }
    })();
  </script>
  <script src="js/profile.js"></script>
  <script src="js/theme.js"></script>
  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>


</body>
</html>
